# Airdrop Contract - –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

**–£–±—Ä–∞–Ω–æ:**
- ‚ùå –§—É–Ω–∫—Ü–∏—è `claim()` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –∫–ª–µ–π–º—è—Ç —Å–∞–º–∏
- ‚ùå `claimEndTime` ‚Äî –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–ª–µ–π–º–∞
- ‚ùå `hasClaimed()` ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `hasReceived()`

**–û—Å—Ç–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ `batchSend()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Merkle proof (–¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏)
- ‚úÖ `batchSendDirect()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ø—Ä–æ—â–µ)
- ‚úÖ `setMerkleRoot()` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Merkle root (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ `withdrawTokens()` ‚Äî –≤—ã–≤–æ–¥ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–æ–∫–µ–Ω–æ–≤

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### –¢–æ–ª—å–∫–æ owner –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã

–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:
1. **Owner** –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ç–æ–∫–µ–Ω—ã –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
2. **Owner** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ `batchSend()` –∏–ª–∏ `batchSendDirect()`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ **–ø–æ–ª—É—á–∞—é—Ç —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

**–ü—Ä–æ Merkle root (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- Merkle root –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ **–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**
- –≠—Ç–æ —Å–ø–æ—Å–æ–± –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—É–º–º—ã
- –ë–µ–∑ Merkle root: –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–æ–∫–µ–Ω—ã (–ø—Ä–æ—â–µ)
- –° Merkle root: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ + –ª—é–¥–∏ –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å (–ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ)

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** –°–º. `MERKLE_ROOT_EXPLANATION.md`

---

## üìù –§—É–Ω–∫—Ü–∏–∏

### 1. `batchSend()` ‚Äî —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Merkle proof

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```javascript
await airdrop.batchSend(
    recipients,    // –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
    amounts,       // —Å—É–º–º—ã
    merkleProofs   // Merkle proofs –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
);
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- ‚úÖ –ù—É–∂–Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (Merkle root –ø—É–±–ª–∏—á–µ–Ω)
- ‚úÖ –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—É–º–º—ã
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –∞–∏—Ä–¥—Ä–æ–ø

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Merkle root –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (`setMerkleRoot()`)
- –ù—É–∂–Ω—ã Merkle proofs –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è

---

### 2. `batchSendDirect()` ‚Äî –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ Merkle

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```javascript
await airdrop.batchSendDirect(
    recipients,  // –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
    amounts      // —Å—É–º–º—ã
);
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ Merkle proof
- ‚úÖ –î–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –¢–æ–ª—å–∫–æ —Å–ø–∏—Å–∫–∏ –∞–¥—Ä–µ—Å–æ–≤ –∏ —Å—É–º–º

---

## üîß –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**CSV —Ñ–∞–π–ª:**
```csv
address,amount
0x1234...,1000
0x5678...,2000
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `batchSend()` (—Å Merkle):**
```bash
node scripts/generate-merkle-tree.js data/token-balances.csv
# –ü–æ–ª—É—á–∏—Ç–µ merkle-tree-data.json —Å proofs
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `batchSendDirect()` (–±–µ–∑ Merkle):**
- –ü—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–π—Ç–µ CSV –∏ —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –º–∞—Å—Å–∏–≤—ã

---

### –®–∞–≥ 2: –î–µ–ø–ª–æ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```javascript
// 1. –î–µ–ø–ª–æ–π
const airdrop = await Airdrop.deploy(tokenAddress);

// 2. –ü–µ—Ä–µ–≤–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤
await savitriCoin.transfer(airdrop.address, totalAmount);

// 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Merkle root
// –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ batchSend()
await airdrop.setMerkleRoot("0xabc123...");
```

---

### –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç A: –° Merkle proof (`batchSend`)**

```javascript
// –ò–∑ merkle-tree-data.json
const batch = recipients.slice(0, 100);

const addresses = batch.map(r => r.address);
const amounts = batch.map(r => r.amount);
const proofs = batch.map(r => r.proof);

await airdrop.batchSend(addresses, amounts, proofs);
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ë–µ–∑ Merkle (`batchSendDirect`)**

```javascript
// –ò–∑ CSV
const addresses = ["0x1234...", "0x5678..."];
const amounts = [
    ethers.utils.parseEther("1000"),
    ethers.utils.parseEther("2000")
];

await airdrop.batchSendDirect(addresses, amounts);
```

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–ª—É—á–∏–ª –ª–∏ –∞–¥—Ä–µ—Å —Ç–æ–∫–µ–Ω—ã
const received = await airdrop.hasReceived("0x1234...");

// –í—ã–≤–µ—Å—Ç–∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç–æ–∫–µ–Ω—ã
await airdrop.withdrawTokens(ownerAddress, remainingAmount);
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç DoS
- –ú–∞–∫—Å–∏–º—É–º 100 –∞–¥—Ä–µ—Å–æ–≤ –∑–∞ –±–∞—Ç—á
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- `mapping(address => bool) public sent`
- –ö–∞–∂–¥—ã–π –∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

### –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Merkle)
- Merkle root –ø—É–±–ª–∏—á–µ–Ω
- –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–¥—Ä–µ—Å –≤ —Å–ø–∏—Å–∫–µ
- Proof –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å—É–º–º—ã

---

## üìä –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–±–µ–∑ Merkle)

```javascript
// –ß–∏—Ç–∞–µ–º CSV
const csv = fs.readFileSync('data/token-balances.csv', 'utf8');
const lines = csv.split('\n').filter(l => l.trim());

const addresses = [];
const amounts = [];

for (const line of lines) {
    const [address, amount] = line.split(',');
    addresses.push(address.trim());
    amounts.push(ethers.utils.parseEther(amount.trim()));
}

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á–∞–º–∏ –ø–æ 100
for (let i = 0; i < addresses.length; i += 100) {
    const batchAddresses = addresses.slice(i, i + 100);
    const batchAmounts = amounts.slice(i, i + 100);
    
    await airdrop.batchSendDirect(batchAddresses, batchAmounts);
}
```

### –ü—Ä–∏–º–µ—Ä 2: –° Merkle proof (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ)

```javascript
// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Merkle tree
// node scripts/generate-merkle-tree.js data/token-balances.csv

// –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ
const data = JSON.parse(fs.readFileSync('merkle-tree-data.json'));

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á–∞–º–∏
for (let i = 0; i < data.recipients.length; i += 100) {
    const batch = data.recipients.slice(i, i + 100);
    
    const addresses = batch.map(r => r.address);
    const amounts = batch.map(r => r.amount);
    const proofs = batch.map(r => r.proof);
    
    await airdrop.batchSend(addresses, amounts, proofs);
}
```

---

## üéØ –ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –≤—ã–±—Ä–∞—Ç—å?

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `batchSendDirect()` –µ—Å–ª–∏:
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ –ø—É–±–ª–∏—á–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- ‚úÖ –î–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ –•–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–µ–µ –∏ –ø—Ä–æ—â–µ

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `batchSend()` –µ—Å–ª–∏:
- ‚úÖ –ù—É–∂–Ω–∞ –ø—É–±–ª–∏—á–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- ‚úÖ –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å—É–º–º
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –∞–∏—Ä–¥—Ä–æ–ø
- ‚úÖ –ì–æ—Ç–æ–≤—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Merkle tree

---

## üìù –†–µ–∑—é–º–µ

**–¢–µ–ø–µ—Ä—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:**
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ **–Ω–µ –∫–ª–µ–π–º—è—Ç** —Ç–æ–∫–µ–Ω—ã
- ‚úÖ **Owner –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç** —Ç–æ–∫–µ–Ω—ã –±–∞—Ç—á–∞–º–∏
- ‚úÖ –î–≤–∞ —Å–ø–æ—Å–æ–±–∞: —Å Merkle proof –∏–ª–∏ –±–µ–∑
- ‚úÖ –ü—Ä–æ—Å—Ç–æ –∏ —É–¥–æ–±–Ω–æ –¥–ª—è owner

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —É owner, –ø—Ä–æ—Å—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Merkle.

